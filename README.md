### grep/sed/awk

#### <a name='toc'>Содержание</a>

1. [&&&&&&&&&](#initialization_system)
2. [&&&&&&&&&](#managing_services)
3. [&&&&&&&&&&]() 
4. [Дополнительные источники](#recommended_sources)


#### 1. [[⬆]](#toc) <a name=''>&&&&&&&&&&&&&&&&&&&</a>

**grep** - Слово «грепать» входит в топ самых популярных терминов, используемых разработчиками. Оно происходит от одноименной консольной утилиты grep (сокращение от `global regular expression print`). Эта утилита выполняет поиск определенного текста по файлу или файлам.

**sed** - это потоковый редактор текста (от stream editor), c помощью которого можно выполнять с файлами множество операций вроде поиска и замены, вставки или удаления. При этом чаще всего он используется именно для поиска и замены.

**awk** - это скриптовый язык, который полезен при работе в командной строке и широко применяется для обработки текста. При использовании awk вы можете выбирать данные – один или более отдельных фрагментов текста – на основе заданного критерия. Например, с помощью awk можно выполнять поиск конкретного слова или шаблона во фрагменте текста, а также выбирать определённую строку/столбец в файле.

#### Регулярные выражения

-i = игнорировать регистр

Вывести все содержащие 2 символа которые содержит символы от a до f и от 0 до 9 и в конце :
```
ip a | grep -i -P "[0-9a-fA-F]{2}:"
```

Так можно вывести ВСЕ мак адреса
```
ip a | grep -P "[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}"
```

Пять блоково по два символа
```
ip a | grep -P "([0-9a-fA-F]{2}:){5}"
```

Пять блоково по два символа + одни блок в конце
```
ip a | grep -P "([0-9a-fA-F]{2}:){5}[0-9a-fA-F]{2}"
```

Вывести шаблон руг выражения + любое колличество символов (.*). Точка это любой символ, * любое колличество символов.
```
ip a | grep -P "([0-9aA-fF]{2}:){5}[0-9a-fA-F]{2}.*" -o -n
```

Вывести все что начинается с любого количества символов, но заканчивается на 00
```
ip a | grep -P "^.*00$" -o`
```
Фильтруем пустрые строки и комментарии
```
sudo grep -v ^# /etc/init.d/nginx | grep -v ^$ | wc -l
sudo grep -v ^# /etc/ssh/sshd_config | grep -v ^$
```

Считаем строки
```
wc -l /etc/init.d/nginx
type systemctl
```

#### Парсинг логов по ip

Вывести первый столбец файла и отсортировать по уникальность (sort -u)
```
sudo awk '{print $1}' /var/log/nginx/access.log | sort -u
```

Вывести самый часто обращаемый адрес
```
sudo awk '{print $1}' /var/log/nginx/access.log | sort | uniq -c
```

Отсортировать по колличесву обращений. От наименьшего к наибольшему
```
sudo awk '{print $1}' /var/log/nginx/access.log | sort | uniq -c | sort -n

whois 139.59.12.23.2 | grep -i { count | netname }

for i in  `sudo awk '{print $1}' /var/log/nginx/access.log | sort -u`; do echo $i; done
for i in  `sudo awk '{print $1}' /var/log/nginx/access.log | sort -u`; do whois $i | grep "Country"; done
for i in  `sudo awk '{print $1}' /var/log/nginx/access.log | sort -u`; do whois $i | grep "Country"; done | sort | uniq -c | sort -n
```


#### Вывод ошибки
```
sudo awk '{print $9}' /var/log/nginx/access.log
sudo awk '{print $9}' /var/log/nginx/access.log | grep -P "(^[0-9]$)"
```

Вывод только чисел
```
sudo awk '{print $9}' /var/log/nginx/access.log | grep -P "[0-9]*"
```

Вывести строки и отсортировать по наибольшему числу
```
sudo awk '{print $9}' /var/log/nginx/access.log | grep -P "[0-9]{3}" | sort  | uniq -c | sort -n
```

Показать третью строчку
```
sed -n 3p file
```

Удалить первую строчку
```
sed -i 1d file
```

Добавить ааа после two в файл file
```
sed -i /two/aaa file
```

Заменить two на ааа
```
sed -i s/two/aaa/g file
```

Поменять местами asb с fgh
```
echo "asd fgh" | sed "s/\(asb)\ \(fgh\)/\2 \1"
```

##### Дом работа

Написать скрипт для CRON, который раз в час будет формировать письмо и отправлять на заданную почту.

Необходимая информация в письме:

1. Список IP адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;
2. Список запрашиваемых URL (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;
3. Ошибки веб-сервера/приложения c момента последнего запуска;
4. Список всех кодов HTTP ответа с указанием их кол-ва с момента последнего запуска скрипта.
5. Скрипт должен предотвращать одновременный запуск нескольких копий, до его завершения.

**Решение:** https://github.com/Holdfast12/bash-homework-otus/blob/main/script.sh

##### Принцип работы

&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&

&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&

##### Конфигурационные файлы systemd
&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&

| Путь | Описание |
| ------- | ----------- |
| `/etc/systemd/system` | юниты/модули, которые создаёт администратор системы. Обладают самым высоким приоритетом.|
| `/run/systemd/system` | юниты/модули, которые создаются в процессе работы системы. Приоритет этого каталога ниже, чем каталога /etc/systemd/system/, но выше, чем у /usr/lib/systemd/system |
| `/usr/lib/systemd/system` | юниты/модули сервисов, установленных с помощью менеджера пакетов. Самый простой пример — веб-серверы: Apache или Nginx. |



#### 4. [[⬆]](#toc) <a name='recommended_sources'>Дополнительные источники</a>

1. [Bash - Википедия](https://ru.wikipedia.org/wiki/Bash)
2. [????????????????](https://www.alexgur.ru/articles/2275/)
3. [????????????????](https://losst.pro/nastrojka-zagruzchika-grub)
4. Весь Linux Для тех, кто хочет стать профессионалом, стр.681
